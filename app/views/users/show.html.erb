<section class="module-medium" id="demos">
  <div class="container">
    <section class="">
      <% if @user.coverimg.blank? %>
        <%= image_tag('https://s3-ap-northeast-1.amazonaws.com/tamtim/uploads/usercoverimg.jpg', :class => "mypagecover-img") %>
      <% else %>
        <%= image_tag(@user.coverimg.url, :class => "mypagecover-img") %>
      <% end %>
      <div class="mypageicon">
        <% if (@user.provider == "facebook") %>
          <% @user.icon = @user.icon.insert(4,"s") %>
          <%= image_tag @user.icon, :class => "img-circle", :alt => "Karan Singh Sisodia", :size => "100x100" %>
        <% elsif @user.avator %>
          <%= image_tag(@user.avator.to_s, :class => "img-circle", :alt => "Karan Singh Sisodia", :size => "100x100") %>
        <% else %>
          <%= image_tag('/no_img.png', :class => "img-circle", :alt => "Karan Singh Sisodia", :size => "100x100") %>
        <% end %>
      </div>
      <div class="follow_button">
        <%= render 'follow_form' %>
      </div>
    </section>

    <div class="row">
      <div class="col-sm-8">
        <h3><%= @user.name %></h3>
        <div><%= @user.profile  %></div>
        <% if current_user && @user.id == current_user.id %>
          <div class="UserEditLink">
            <%= link_to(content_tag(:i, 'プロフィールを編集する', class: 'fa fa-cog'), edit_user_registration_path)  %>
          </div>
        <% end %>
      </div>

      <div class="col-sm-4">
        <table class="table">
          <tbody>
            <tr>
              <td>レビュー数</td>
              <td><%= @user.reviews.count %>件</td>
            </tr>
            <tr>
              <td>レビューへの訪問者数</td>
              <td><%= number_with_delimiter(@page_views) %>人</td>
            </tr>
            <tr>
              <td>レビューへのお気に入り数</td>
              <% @count = 0 %>
              <% @user.reviews.each do |review| %>
                <% @count += review.favorites.count %>
              <% end %>
              <td><%= @count %>件</td>
            </tr>
            <tr>
              <td>レビューへのいいね！数</td>
              <% @count = 0 %>
              <% @user.reviews.each do |review| %>
                <% @count += review.likes.count %>
              <% end %>
              <td><%= @count %>件</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-8">
        <!-- パンくずリスト（うまく表示されないのでコメントアウト）
        <% breadcrumb :user, @user %>
        <% provide(:title, @user.name) %>
        -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
        <script>
          $(function(){
  	        $('.readmore').click(function(){
  		        $(this).hide();
  		        $(this).parent('.main').removeClass('onhidden');
  	        });
          });
        </script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
var searchBox = '.search-box'; // 絞り込む項目を選択するエリア
var listItem = '.list_item';   // 絞り込み対象のアイテム
var hideClass = 'is-hide';     // 絞り込み対象外の場合に付与されるclass名




$(function() {
    // 絞り込み項目を変更した時
    $(document).on('change', searchBox + ' input', function() {
        search_filter();
    });
});

/**
 * リストの絞り込みを行う
 */
function search_filter() {
    // 非表示状態を解除
    $(listItem).removeClass(hideClass);
    for (var i = 0; i < $(searchBox).length; i++) {
        var name = $(searchBox).eq(i).find('input').attr('name');
        // 選択されている項目を取得
        var searchData = get_selected_input_items(name);
        // 選択されている項目がない、またはALLを選択している場合は飛ばす
        if(searchData.length === 0 || searchData[0] === '') {
            continue;
        }
        // リスト内の各アイテムをチェック
        for (var j = 0; j < $(listItem).length; j++) {
            // アイテムに設定している項目を取得
            var itemData = $(listItem).eq(j).data(name);
            // 絞り込み対象かどうかを調べる
            if(searchData.indexOf(itemData) === -1) {
                $(listItem).eq(j).addClass(hideClass);
            }
        }
    }
}

/**
 * inputで選択されている値の一覧を取得する
 * @param  {String} name 対象にするinputのname属性の値
 * @return {Array}       選択されているinputのvalue属性の値
 */
function get_selected_input_items(name) {
    var searchData = [];
    $('[name=' + name + ']:checked').each(function() {
        searchData.push($(this).val());
    });
    return searchData;
}

</script>

<form>

    <div class="search-box">
        <span class="search-box_label">タイトル:</span>
        <input type="checkbox" name="color" value="">ALL
        <% @tag.each do |tag| %>
        <input type="checkbox" name="color" value="<%= tag.name %>"><%= tag.name %>
<% end %>
    </div>
</form>

        <ul class="nav nav-tabs">
          <li class="nav-item active">
            <a href="#tab1" class="nav-link" data-toggle="tab">投稿一覧</a>
          </li>
          <li class="nav-item">
            <a href="#tab2" class="nav-link" data-toggle="tab">お気に入り一覧</a>
          </li>
        </ul>
        <div class="tab-content">
          <div id="tab1" class="tab-pane active">
            <div class="waku">
              <input type="checkbox" name="riyu" value="1" checked="checked">すべて
              <input type="checkbox" name="riyu" value="2">#サプライズ
              <input type="checkbox" name="riyu" value="3">#デート
              <input type="checkbox" name="riyu" value="4">	#apple
              <input type="checkbox" name="riyu" value="5">	#iphone
              <input type="checkbox" name="riyu" value="6">	#mac
              <input type="checkbox" name="riyu" value="7">	#スマホ
              <input type="checkbox" name="riyu" value="8">	#周辺機器
              <input type="checkbox" name="riyu" value="9">	#イヤフォン
              <input type="checkbox" name="riyu" value="10">	#便利
              <input type="checkbox" name="riyu" value="11">	#おしゃれ
              <input type="checkbox" name="riyu" value="12">	#プレゼント
              <input type="checkbox" name="riyu" value="13">	#カメラ
              <input type="checkbox" name="riyu" value="14">	#日用品
              <input type="checkbox" name="riyu" value="15">	#工具
              <input type="checkbox" name="riyu" value="16">	#本
              <input type="checkbox" name="riyu" value="17">	#lifehack
              <input type="checkbox" name="riyu" value="18">	#音楽
              <input type="checkbox" name="riyu" value="19">	#文房具
              <input type="checkbox" name="riyu" value="20">	#漫画
              <input type="checkbox" name="riyu" value="21">	#ビジネス
              <input type="checkbox" name="riyu" value="22">	#筋トレ
              <input type="checkbox" name="riyu" value="23">	#スポーツ
              <input type="checkbox" name="riyu" value="24">	#健康
              <input type="checkbox" name="riyu" value="25">	#ランニング
              <input type="checkbox" name="riyu" value="26">	#スピーカー
              <input type="checkbox" name="riyu" value="27">	#美容
              <input type="checkbox" name="riyu" value="28">	#キッチン
              <input type="checkbox" name="riyu" value="29">	#家具
              <input type="checkbox" name="riyu" value="30">	#キャンプ
              <input type="checkbox" name="riyu" value="31">	#アウトドア
              <input type="checkbox" name="riyu" value="32">	#春
              <input type="checkbox" name="riyu" value="33">	#夏
              <input type="checkbox" name="riyu" value="34">	#秋
              <input type="checkbox" name="riyu" value="35">	#冬
              <input type="checkbox" name="riyu" value="36">	#海
              <input type="checkbox" name="riyu" value="37">	#山
              <input type="checkbox" name="riyu" value="38">	#旅行
              <input type="checkbox" name="riyu" value="39">	#ガジェット
              <input type="checkbox" name="riyu" value="40">	#防災
              <input type="checkbox" name="riyu" value="41">	#食べ物
              <input type="checkbox" name="riyu" value="42">	#ワイヤレス
              <input type="checkbox" name="riyu" value="43">	#まとめる
              <input type="checkbox" name="riyu" value="44">	#インテリア
              <input type="checkbox" name="riyu" value="45">	#サプリ
              <input type="checkbox" name="riyu" value="46">	#ウェアラブル
              <input type="checkbox" name="riyu" value="47">	#アクセサリ
              <input type="checkbox" name="riyu" value="48">	#生活家電
              <input type="checkbox" name="riyu" value="49">	#掃除
              <input type="checkbox" name="riyu" value="50">	#収納
              <input type="checkbox" name="riyu" value="51">	#雑貨
            </div>
            <div class="list">
              <% @user.reviews.each do |review| %>
              <div class="list_item" data-kind="果物" data-color="<%= review.skill_list  unless review.skill_list.blank? %>">
                <div class="post">
                  <div class="post-header font-alt">
                    <h2 class="post-title"><%= review.title %></h2>
                    <div class="post-meta">
                      By&nbsp;<%= link_to @user.name, @user %>&nbsp;| <%= review.created_at.strftime('%Y-%m-%d') %>|<%= render 'reviews/tag_list', tag_list: review.skill_list  unless review.skill_list.blank? %> | <%= review.comments.count %> comments
                    </div>
                  </div>
                  <div class="post-entry">
                    <div class="main onhidden">
                      <%== review.content %>
                      <div class="readmore">
                        <span>続きを読む</span>
                      </div>
                    </div>
                  </div>
                  <div class="post-more">
                    <%= link_to '詳細を確認する', review_path(review.id) %>
                    <% if current_user && @user.id == current_user.id %>
                      <%= link_to "編集する", edit_review_path(review.id) %>
                      <%= link_to 'ブログを削除する', review_path(review.id), method: :delete ,data: { confirm: '本当に削除していいですか？' } %>
                    <% end %>
                  </div>
                </div>
              </div>
              <% end %>
            </div>
          </div>
          <div id="tab2" class="tab-pane">
            <% @user.favorite_reviews.each do |review| %>
            <div class="post">
              <div class="post-thumbnail">
                <%= image_tag(review.image.url, :class => "fit-img") if review.image.url %>
              </div>
              <div class="post-header font-alt">
                <h2 class="post-title"><%= review.title %></h2>
                <div class="post-meta">
                  <% post_user = User.find(review.user_id) %>
                    By&nbsp;<%= link_to post_user.name, user_path(post_user.id) %>&nbsp;| <%= review.created_at.strftime('%Y-%m-%d') %> | <%= review.comments.count %> comments
                </div>
              </div>
              <div class="post-entry">
                <div class="main onhidden">
                  <%== review.content %>
                  <div class="readmore">
                    <span>続きを読む</span>
                  </div>
                </div>
              </div>
              <div class="post-more">
                <%= link_to '詳細を確認する', review_path(review.id) %>
              </div>
            </div>
            <% end %>
          </div>
        </div>
      </div>


      <div class="col-sm-4 col-md-3 col-md-offset-1 sidebar">
        <div class="widget">
          <h5 class="widget-title font-alt">つながり</h5>
          <ul class="icon-list">
            <%= render 'stats' %>
          </ul>
        </div>
        <div class="widget">
          <h5 class="widget-title font-alt">Recent Posts</h5>
          <ul class="icon-list">
          </ul>
        </div>
        <div class="widget">
          <h5 class="widget-title font-alt">Popular Posts</h5>
          <ul class="icon-list">
          </ul>
        </div>
        <div class="widget">
          <h5 class="widget-title font-alt">Tag</h5>
          <div class="tags font-serif">
            <a href="#" rel="tag">Blog</a>
            <a href="#" rel="tag">Photo</a>
            <a href="#" rel="tag">Video</a>
            <a href="#" rel="tag">Image</a>
            <a href="#" rel="tag">Minimal</a>
            <a href="#" rel="tag">Post</a>
            <a href="#" rel="tag">Theme</a>
            <a href="#" rel="tag">Ideas</a>
            <a href="#" rel="tag">Tags</a>
            <a href="#" rel="tag">Bootstrap</a>
            <a href="#" rel="tag">Popular</a>
            <a href="#" rel="tag">English</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
